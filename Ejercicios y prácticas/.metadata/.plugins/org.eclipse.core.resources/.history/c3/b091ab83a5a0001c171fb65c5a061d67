package ch.makery.address.view;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Optional;

import ch.makery.address.Main;
import ch.makery.address.model.DateUtil;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.scene.control.Alert;
import javafx.scene.control.Alert.AlertType;
import javafx.scene.control.ButtonType;
import javafx.scene.control.TextField;
import javafx.stage.Window;

public class DialogoController {

	
    @FXML
    private TextField birthday;

    @FXML
    private TextField city;

    @FXML
    private TextField firstName;

    @FXML
    private TextField lastName;

    @FXML
    private TextField pc;

    @FXML
    private TextField street;
    
    //private TextField[] fields;
    private Map<String, TextField> fields = new HashMap<>();
    
    private List<String> errores = new ArrayList<>();
    
    Alert errorAlert = new Alert(AlertType.ERROR);
    Alert infoAlert = new Alert(AlertType.NONE);
    
    private Main main;
    

    @FXML
    void cancelAction(ActionEvent event) {

    }

    @FXML
    void okAction(ActionEvent event) {
    	Iterator<String> it = fields.keySet().iterator();
    	 
    	while(it.hasNext()){
    	    String clave = it.next();
    	    TextField valor = fields.get(clave);
    	    String error = "";
    	    if (valor.getText().equals("")) {
    	    	error = "El campo " + clave + " está vacío";
    	    	errores.add(error);
    	    }
    	    if(clave.equals("postal code")) {
    	    	try {
    	    		int pc = Integer.parseInt(valor.getText());
    	    	}catch(Exception e) {
    	    		error = "Postal code no válido. Debe ser un número entero";
    	    		errores.add(error);
    	    	}
    	    } else if(clave.equals("birthday")) {
    	    	if (DateUtil.parse(valor.getText()) == null) {
    	    		error = "El campo " + clave + " no es válido. Usa el formato dd/mm/yyyy";
    	    		errores.add(error);
    	    	}
    	    }
    	    
    	}
    	if(errores.size()>0) {
	    	errorAlert.setTitle("Hay campos incorrectos");
	    	errorAlert.setHeaderText("Por favor, rellena correctamente los campos");
	    	errorAlert.setContentText(String.join("\n", errores));
	    	
	
	    	errorAlert.showAndWait();
	    	errores.clear();
    	}else {
    		infoAlert.setTitle("Éxito");
	    	infoAlert.setHeaderText("Se ha creado la persona");

	    	infoAlert.showAndWait();
	    	
	    	ButtonType goodButton = new ButtonType("Good");
            ButtonType badButton = new ButtonType("Bad");
            
            Window window = infoAlert.getDialogPane().getScene().getWindow();
            window.setOnCloseRequest(e -> infoAlert.hide());
            Optional<ButtonType> result = infoAlert.showAndWait();
            result.ifPresent(res->{
                if (res.equals(goodButton)) {
                    System.out.println("Good");
                } else if (res.equals(badButton)) {
                    System.out.println("Bad");
                }
            });
	    	
	    	
    	}
    }

    @FXML
    void initialize() {
    	fields.put("first name", firstName);
    	fields.put("last name", lastName);
    	fields.put("street", street);
    	fields.put("city", city);
    	fields.put("postal code", pc);
    	fields.put("birthday", birthday);

    }
    
    public void setMain(Main main) {
		this.main = main;
	}

}
